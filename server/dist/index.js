(()=>{var e={500:(e,r,t)=>{t(142).config(),e.exports={MONGODB:process.env.MONGODB,SECRET_KEY:process.env.SECRET_KEY}},709:(e,r,t)=>{function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,i,s,o){try{var a=e[s](o),u=a.value}catch(e){return void t(e)}a.done?r(u):Promise.resolve(u).then(n,i)}function a(e){return function(){var r=this,t=arguments;return new Promise((function(n,i){var s=e.apply(r,t);function a(e){o(s,n,i,a,u,"next",e)}function u(e){o(s,n,i,a,u,"throw",e)}a(void 0)}))}}var u=t(432),c=t(344),l=t(498).UserInputError,d=t(627),p=d.validateRegisterInput,m=d.validateLoginInput,f=t(722),w=t(500).SECRET_KEY;function g(e){return c.sign({id:e.id,email:e.email,fullname:e.fullname,admin:!0,user:!1},w,{expiresIn:"1h"})}e.exports={Mutation:{loginAdmin:function(e,r){return a(regeneratorRuntime.mark((function e(){var t,n,s,o,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.email,n=r.password,s=m(t,n),o=s.errors,s.isValid){e.next=4;break}throw new l("Errors",{errors:o});case 4:return e.next=6,f.findOne({email:t});case 6:if(a=e.sent){e.next=10;break}throw o.email="Email not found",new l("Email not found",{errors:o});case 10:return e.next=12,u.compare(n,a.password);case 12:if(e.sent){e.next=16;break}throw o.password="Password is invalid!",new l("Password is invalid!",{errors:o});case 16:return c=g(a),e.abrupt("return",i(i({},a._doc),{},{id:a._id,token:c}));case 18:case"end":return e.stop()}}),e)})))()},registerAdmin:function(e,r){return a(regeneratorRuntime.mark((function e(){var t,n,s,o,a,c,d,m,w,v,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.registerInput,n=t.fullname,s=t.email,o=t.password,a=t.confirmPassword,c=p(n,s,o,a),d=c.isValid,m=c.errors,d){e.next=4;break}throw new l("Errors",{errors:m});case 4:return e.next=6,f.findOne({email:s});case 6:if(!e.sent){e.next=9;break}throw new l("Email is taken",{errors:{email:"This email is taken"}});case 9:return e.next=11,u.hash(o,12);case 11:return o=e.sent,w=new f({fullname:n,email:s,password:o}),e.next=15,w.save();case 15:return v=e.sent,b=g(v),e.abrupt("return",i(i({},v._doc),{},{id:v._id,token:b}));case 18:case"end":return e.stop()}}),e)})))()}}}},491:(e,r,t)=>{function n(e,r,t,n,i,s,o){try{var a=e[s](o),u=a.value}catch(e){return void t(e)}a.done?r(u):Promise.resolve(u).then(n,i)}function i(e){return function(){var r=this,t=arguments;return new Promise((function(i,s){var o=e.apply(r,t);function a(e){n(o,i,s,a,u,"next",e)}function u(e){n(o,i,s,a,u,"throw",e)}a(void 0)}))}}var s,o=t(498),a=o.AuthenticationError,u=o.UserInputError,c=t(224),l=t(297);e.exports={Mutation:{createComment:(s=i(regeneratorRuntime.mark((function e(r,t,n){var i,s,o,a,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.postId,s=t.body,o=c(n),a=o.email,d=o.fullname,""!==s.trim()){e.next=4;break}throw new u("Empty comment",{errors:{body:"Comment field is required"}});case 4:return e.next=6,l.findById(i);case 6:if(!(p=e.sent)){e.next=14;break}return p.comments.unshift({body:s,email:a,fullname:d,createdAt:(new Date).toISOString()}),e.next=11,p.save();case 11:return e.abrupt("return",p);case 14:throw new u("Post not found");case 15:case"end":return e.stop()}}),e)}))),function(e,r,t){return s.apply(this,arguments)}),deleteComment:function(e,r,t){return i(regeneratorRuntime.mark((function e(){var n,i,s,o,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.postId,i=r.commentId,s=c(t),o=s.email,e.next=4,l.findById(n);case 4:if(!(d=e.sent)){e.next=17;break}if(p=d.comments.findIndex((function(e){return e.id===i})),d.comments[p].email!==o){e.next=14;break}return d.comments.splice(p,1),e.next=11,d.save();case 11:return e.abrupt("return",d);case 14:throw new a("Action not allowed");case 15:e.next=18;break;case 17:throw new u("Post not found");case 18:case"end":return e.stop()}}),e)})))()}}}},128:(e,r,t)=>{function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var o=t(441),a=t(112),u=t(709),c=t(491);e.exports={Post:{likeCount:function(e){return e.likes.length},commentCount:function(e){return e.comments.length}},Query:i({},o.Query),Mutation:i(i(i(i({},a.Mutation),u.Mutation),o.Mutation),c.Mutation)}},441:(e,r,t)=>{function n(e,r,t,n,i,s,o){try{var a=e[s](o),u=a.value}catch(e){return void t(e)}a.done?r(u):Promise.resolve(u).then(n,i)}function i(e){return function(){var r=this,t=arguments;return new Promise((function(i,s){var o=e.apply(r,t);function a(e){n(o,i,s,a,u,"next",e)}function u(e){n(o,i,s,a,u,"throw",e)}a(void 0)}))}}var s=t(498),o=s.AuthenticationError,a=s.UserInputError,u=t(880),c=t(673),l=t(320)((new(0,t(860).JSDOM)).window),d=t(627).validatePostInput,p=t(297),m=t(224);e.exports={Query:{getPosts:function(){return i(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.find().sort({createdAt:-1});case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),new Error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getPost:function(e,r){return i(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.slug,e.prev=1,e.next=4,p.findOne({slug:t});case 4:if(!(n=e.sent)){e.next=9;break}return e.abrupt("return",n);case 9:throw new Error("Post not found");case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),new Error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))()},getPostforUpdate:function(e,r){return i(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.postId,e.prev=1,e.next=4,p.findById(t);case 4:if(!(n=e.sent)){e.next=9;break}return e.abrupt("return",n);case 9:throw new Error("Post not found");case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),new Error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))()}},Mutation:{createPost:function(e,r,t){return i(regeneratorRuntime.mark((function e(){var n,i,s,o,f,w,g,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.title,i=r.desc,s=r.body,o=m(t),f=d(n,i,s),w=f.errors,f.valid){e.next=5;break}throw new a("Errors",{errors:w});case 5:return e.next=7,p.findOne({title:n});case 7:if(!e.sent){e.next=10;break}throw new a("Title is taken",{errors:{email:"This title is already taken."}});case 10:return g=new p({title:n,slug:c(n,{lower:!0,strict:!0}),desc:i,body:s,sanitizedHtml:l.sanitize(u(s)),user:o.id,email:o.email,fullname:o.fullname}),e.next=13,g.save();case 13:return v=e.sent,t.pubsub.publish("NEW_POST",{newPost:v}),e.abrupt("return",v);case 16:case"end":return e.stop()}}),e)})))()},updatePost:function(e,r,t){return i(regeneratorRuntime.mark((function e(){var n,i,s,f,w,g,v,b,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.postId,i=r.title,s=r.desc,f=r.body,w=m(t),g=d(i,s,f),v=g.errors,g.valid){e.next=5;break}throw new a("Errors",{errors:v});case 5:return e.prev=5,e.next=8,p.findById(n);case 8:if(b=e.sent,w.username!==b.username){e.next=16;break}return e.next=12,p.findByIdAndUpdate(n,{title:i,slug:c(i,{lower:!0,strict:!0}),desc:s,body:f,sanitizedHtml:l.sanitize(u(f))});case 12:return h=e.sent,e.abrupt("return",h);case 16:throw new o("Action not allowed");case 17:e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(5),new Error(e.t0);case 22:case"end":return e.stop()}}),e,null,[[5,19]])})))()},deletePost:function(e,r,t){return i(regeneratorRuntime.mark((function e(){var n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.postId,i=m(t),e.prev=2,e.next=5,p.findById(n);case 5:if(s=e.sent,i.email!==s.email){e.next=12;break}return e.next=9,s.delete();case 9:return e.abrupt("return","Post deleted successfully");case 12:throw new o("Action not allowed");case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(2),new Error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})))()},likePost:function(e,r,t){return i(regeneratorRuntime.mark((function e(){var n,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.postId,i=m(t),s=i.email,e.next=4,p.findById(n);case 4:if(!(o=e.sent)){e.next=12;break}return o.likes.find((function(e){return e.email===s}))?o.likes=o.likes.filter((function(e){return e.email!==s})):o.likes.push({email:s,createdAt:(new Date).toISOString()}),e.next=9,o.save();case 9:return e.abrupt("return",o);case 12:throw new a("Post not found");case 13:case"end":return e.stop()}}),e)})))()}}}},112:(e,r,t)=>{function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,i,s,o){try{var a=e[s](o),u=a.value}catch(e){return void t(e)}a.done?r(u):Promise.resolve(u).then(n,i)}function a(e){return function(){var r=this,t=arguments;return new Promise((function(n,i){var s=e.apply(r,t);function a(e){o(s,n,i,a,u,"next",e)}function u(e){o(s,n,i,a,u,"throw",e)}a(void 0)}))}}var u=t(432),c=t(344),l=t(498).UserInputError,d=t(627),p=d.validateRegisterInput,m=d.validateLoginInput,f=t(309),w=t(500).SECRET_KEY;function g(e){return c.sign({id:e.id,email:e.email,fullname:e.fullname,admin:!1,user:!0},w,{expiresIn:"1h"})}e.exports={Mutation:{loginUser:function(e,r){return a(regeneratorRuntime.mark((function e(){var t,n,s,o,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.email,n=r.password,s=m(t,n),o=s.errors,s.isValid){e.next=4;break}throw new l("Errors",{errors:o});case 4:return e.next=6,f.findOne({email:t});case 6:if(a=e.sent){e.next=10;break}throw o.email="Email not found",new l("Email not found",{errors:o});case 10:return e.next=12,u.compare(n,a.password);case 12:if(e.sent){e.next=16;break}throw o.password="Password is invalid!",new l("Password is invalid!",{errors:o});case 16:return c=g(a),e.abrupt("return",i(i({},a._doc),{},{id:a._id,token:c}));case 18:case"end":return e.stop()}}),e)})))()},registerUser:function(e,r){return a(regeneratorRuntime.mark((function e(){var t,n,s,o,a,c,d,m,w,v,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.registerInput,n=t.fullname,s=t.email,o=t.password,a=t.confirmPassword,c=p(n,s,o,a),d=c.isValid,m=c.errors,d){e.next=4;break}throw new l("Errors",{errors:m});case 4:return e.next=6,f.findOne({email:s});case 6:if(!e.sent){e.next=9;break}throw new l("Email is taken",{errors:{email:"This email is taken"}});case 9:return e.next=11,u.hash(o,12);case 11:return o=e.sent,w=new f({fullname:n,email:s,password:o}),e.next=15,w.save();case 15:return v=e.sent,b=g(v),e.abrupt("return",i(i({},v._doc),{},{id:v._id,token:b}));case 18:case"end":return e.stop()}}),e)})))()},updateUser:function(e,r){return a(regeneratorRuntime.mark((function e(){var t,n,i,s,o,a,c,d,m,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.updateInput,n=t.fullname,i=t.email,s=t.password,o=t.confirmPassword,a=r.userId,c=p(n,i,s,o),d=c.isValid,m=c.errors,d){e.next=4;break}throw new l("Errors",{errors:m});case 4:return e.next=6,f.findOne({email:i});case 6:if(!e.sent){e.next=9;break}throw new l("Email is taken",{errors:{email:"This email is taken"}});case 9:return e.next=11,u.hash(s,12);case 11:return s=e.sent,e.next=14,f.findByIdAndUpdate(a,{fullname:n,email:i,password:s});case 14:return w=e.sent,e.abrupt("return",w);case 16:case"end":return e.stop()}}),e)})))()}}}},316:(e,r,t)=>{var n,i,s,o=t(498).gql;e.exports=o(n||(i=["\n  type Post {\n    id: ID!\n    title: String!\n    desc: String!\n    body: String!\n    slug: String!\n    sanitizedHtml: String!\n    createdAt: String!\n    email: String!\n    fullname: String!\n    comments: [Comment]!\n    likes: [Like]!\n    likeCount: Int!\n    commentCount: Int!\n  }\n  type Comment {\n    id: ID!\n    createdAt: String!\n    email: String!\n    fullname: String!\n    body: String!\n  }\n  type Like {\n    id: ID!\n    createdAt: String!\n    email: String!\n  }\n  type Admin {\n    id: ID!\n    email: String!\n    token: String!\n    fullname: String!\n    createdAt: String!\n    updatedAt: String!\n  }\n  type User {\n    id: ID!\n    email: String!\n    token: String!\n    fullname: String!\n    createdAt: String!\n    updatedAt: String!\n  }\n  input RegisterInput {\n    fullname: String!\n    password: String!\n    confirmPassword: String!\n    email: String!\n  }\n  input UpdateUserInput {\n    fullname: String!\n    email: String!\n    password: String!\n    confirmPassword: String!\n  }\n  type Query {\n    getPosts: [Post]\n    getPost(slug: String!): Post\n    getPostforUpdate(postId: ID!): Post\n  }\n  type Mutation {\n    registerAdmin(registerInput: RegisterInput): Admin!\n    registerUser(registerInput: RegisterInput): User!\n    loginAdmin(email: String!, password: String!): Admin!\n    loginUser(email: String!, password: String!): User!\n    updateUser(updateInput: UpdateUserInput, userId: ID!): User!\n    createPost(title: String!, desc: String!, body: String!): Post!\n    updatePost(postId: ID!, title: String!, desc: String!, body: String!): Post!\n    deletePost(postId: ID!): String!\n    createComment(postId: String!, body: String!): Post!\n    deleteComment(postId: ID!, commentId: ID!): Post!\n    likePost(postId: ID!): Post!\n  }\n"],s||(s=i.slice(0)),n=Object.freeze(Object.defineProperties(i,{raw:{value:Object.freeze(s)}}))))},352:(e,r,t)=>{var n=t(498).ApolloServer,i=t(185),s=t(316),o=t(128),a=t(500).MONGODB,u=process.env.PORT||4e3,c=new n({typeDefs:s,resolvers:o,context:function(e){return{req:e.req}}});i.connect(a).then((function(){return c.listen({port:u})})).then((function(e){console.log("Server running at ".concat(e.url))})).catch((function(e){console.error(e)}))},722:(e,r,t)=>{var n=t(185),i=n.model,s=new(0,n.Schema)({fullname:String,password:String,email:String},{timestamps:!0});e.exports=i("Admin",s)},297:(e,r,t)=>{var n=t(185),i=n.model,s=n.Schema,o=new s({title:String,desc:String,body:String,slug:String,sanitizedHtml:String,username:String,fullname:String,comments:[{body:String,username:String,fullname:String,createdAt:String}],likes:[{username:String,createdAt:String}],user:{type:s.Types.ObjectId,ref:"users"}},{timestamps:!0});e.exports=i("Post",o)},309:(e,r,t)=>{var n=t(185),i=n.model,s=new(0,n.Schema)({fullname:String,password:String,email:String},{timestamps:!0});e.exports=i("User",s)},224:(e,r,t)=>{var n=t(498).AuthenticationError,i=t(344),s=t(500).SECRET_KEY;e.exports=function(e){var r=e.req.headers.authorization;if(r){var t=r.split("Bearer ")[1];if(t)try{return i.verify(t,s)}catch(e){throw new n("Invalid/Expired token")}throw new Error("Authentication token must be 'Bearer [token]")}throw new Error("Authorization header must be provided")}},627:(e,r,t)=>{var n=t(564),i=t(917);e.exports.validateRegisterInput=function(e,r,t,s){var o={};return e=i(e)?"":e,r=i(r)?"":r,t=i(t)?"":t,s=i(s)?"":s,n.isEmpty(e)&&(o.fullname="Name field is required"),n.isEmpty(r)?o.email="Email field is required":n.isEmail(r)||(o.email="Email is invalid"),n.isEmpty(t)&&(o.password="Password field is required"),n.isEmpty(s)&&(o.confirmPassword="Confirm password field is required"),n.isLength(t,{min:6,max:20})||(o.password="Password must be at least 6 characters"),n.equals(t,s)||(o.confirmPassword="Passwords must match"),{errors:o,isValid:i(o)}},e.exports.validateLoginInput=function(e,r){var t={};return e=i(e)?"":e,r=i(r)?"":r,n.isEmpty(e)?t.email="Email field is required":n.isEmail(e)||(t.email="Email is invalid"),n.isEmpty(r)&&(t.password="Password field is required"),{errors:t,isValid:i(t)}},e.exports.validatePostInput=function(e,r,t){var s={};return e=i(e)?"":e,r=i(r)?"":r,t=i(t)?"":t,n.isEmpty(e)&&(s.title="Title field is required"),n.isEmpty(r)&&(s.desc="Description is required"),n.isEmpty(t)&&(s.body="Markdown is required"),{errors:s,isValid:i(s)}}},498:e=>{"use strict";e.exports=require("apollo-server")},432:e=>{"use strict";e.exports=require("bcryptjs")},320:e=>{"use strict";e.exports=require("dompurify")},142:e=>{"use strict";e.exports=require("dotenv")},917:e=>{"use strict";e.exports=require("is-empty")},860:e=>{"use strict";e.exports=require("jsdom")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},880:e=>{"use strict";e.exports=require("marked")},185:e=>{"use strict";e.exports=require("mongoose")},301:e=>{"use strict";e.exports=require("regenerator-runtime/runtime.js")},673:e=>{"use strict";e.exports=require("slugify")},564:e=>{"use strict";e.exports=require("validator")}},r={};function t(n){var i=r[n];if(void 0!==i)return i.exports;var s=r[n]={exports:{}};return e[n](s,s.exports,t),s.exports}t(301),t(352)})();
//# sourceMappingURL=index.js.map